<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>CALayer 学习笔记 - Lmt的博客</title>
  <meta name="author" content="limengtian">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://engili.github.io/blog/2018/04/05/calayer-notes/">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Lmt的博客" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://engili.github.io/blog/2018/04/05/calayer-notes/">
  <meta property="og:title" content="CALayer 学习笔记 - Lmt的博客">
  

  <script src="/javascripts/libs/jquery/jquery-2.1.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">


  
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  

</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      
        <header role="banner">
          <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Lmt的博客</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <!-- <li ><a href="#">Projects</a></li> -->
<li ><a href="/blog/archives">归档</a></li>
<!-- <li ><a href="#">About</a></li> -->
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="sitesearch" value="engili.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


        </header>
      
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="Lmt的博客" />
    
    <meta itemprop="url" content="http://engili.github.io" />
    <article class="hentry" role="article" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2018-04-05T17:05:05+08:00"  data-updated="true" itemprop="datePublished dateCreated">Thu  5 Apr 2018,  5:05 PM</time>
        
      </p>
    
    
    <h1 class="entry-title" itemprop="name headline">
        CALayer 学习笔记
        
    </h1>
    
  </header>


<div class="entry-content clearfix" itemprop="articleBody description"><!-- more -->


<h3>1. CALayer (Model Object)</h3>

<ul>
<li>CALayer是Model Objcet</li>
<li>主要管理<code>位图</code>数据信息，位图内容可以是View绘制也可以是设置的图片</li>
<li>大多数Layer不进行绘制，只是将View的内容换成为位图</li>
</ul>


<h4>1.1 CALayer 坐标</h4>

<h5>1.1.1  point-based 坐标系统</h5>

<ul>
<li>基于屏幕坐标系统，可以表示layer之间的关系</li>
<li><code>bounds</code>和<code>position</code>属性</li>
</ul>


<h5>1.1.2 unit 坐标系统</h5>

<ul>
<li>和屏幕坐标系统无关</li>
<li><code>anchorPoint</code>

<ul>
<li>默认值是（0.5.0.5） 取值范围 0 - 1</li>
<li>影响<code>position</code>属性

<ul>
<li>当anchorPoint为（0，0）时，<code>position</code>在layer左上角</li>
<li>当anchorPoint为（1，1）时，<code>position</code>在layer右下角</li>
<li>当anchorPoint为（0.5，0.5）时，<code>position</code>在layer中心</li>
</ul>
</li>
<li>影响旋转<code>transform</code>的中心点</li>
</ul>
</li>
</ul>


<h3>2. Layer Trees</h3>

<ul>
<li>layer tree

<ul>
<li>layer Model对象，管理位图数据</li>
</ul>
</li>
<li>presentation tree

<ul>
<li>当动画正在进行的时候，可以通过<code>presentation tree</code> 获取当前状态的值</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">presentation</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Self</span><span class="o">?</span>
</span></code></pre></td></tr></table></div></figure>


<p>这个方法，返回 屏幕上正在动画，当前状态下的layer。这个layer对象的sublayers, mask, and superlayer 属性得到的对象都是在<code>presentation tree</code>上</p>

<ul>
<li>render tree

<ul>
<li>执行实际的动画layer，私有类</li>
</ul>
</li>
</ul>


<h3>3. 改变UIView底层对应的Layer</h3>

<ul>
<li>重写<code>layerClass</code>方法即可</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kr">override</span> <span class="k">class</span> <span class="k">var</span> <span class="nl">layerClass</span><span class="p">:</span> <span class="n">Swift</span><span class="p">.</span><span class="n">AnyClass</span> <span class="p">{</span>
</span><span class='line'>        <span class="kr">get</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="bp">CAGradientLayer</span><span class="p">.</span><span class="nb">self</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. CALayer subclasses</h3>

<!--- CAEmitterLayer

Used to implement a Core Animation–based particle emitter system. The emitter layer object controls the generation of the particles and their origin.-->


<h4>4.1 CAGradientLayer</h4>

<ul>
<li>绘制渐变色的Layer</li>
</ul>


<h5>property</h5>

<ul>
<li><code>var colors: [Any]? { get set }</code>

<ul>
<li>数组元素为<code>CGColorRef</code> 才能生效</li>
</ul>
</li>
<li><code>var locations: [NSNumber]? { get set }</code>

<ul>
<li>数组元素为0到1 增长数， 表示颜色停止的区间</li>
<li>数目和<code>colors</code>相同</li>
</ul>
</li>
<li><code>var startPoint: CGPoint { get set }</code>

<ul>
<li>unit 坐标系统属性，渐变色开始位置</li>
<li>默认值是(0.5,0)</li>
</ul>
</li>
<li><code>var endPoint: CGPoint { get set }</code>

<ul>
<li>unit 坐标系统属性，渐变色结束位置</li>
<li>默认值是(0.5,1)</li>
</ul>
</li>
</ul>


<p>创建一个渐变色Layer</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'> <span class="k">class</span> <span class="nl">MTGradientView</span><span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">override</span> <span class="k">class</span> <span class="k">var</span> <span class="nl">layerClass</span><span class="p">:</span> <span class="n">Swift</span><span class="p">.</span><span class="n">AnyClass</span>  <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">CAGradientLayer</span><span class="p">.</span><span class="nb">self</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kr">override</span> <span class="k">init</span><span class="p">(</span><span class="nl">frame</span><span class="p">:</span> <span class="bp">CGRect</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">.</span><span class="k">init</span><span class="p">(</span><span class="nl">frame</span><span class="p">:</span> <span class="n">frame</span><span class="p">)</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">setupLayer</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">fileprivate</span> <span class="k">func</span> <span class="n">setupLayer</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">gradientLayer</span><span class="o">?</span><span class="p">.</span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">red</span><span class="p">.</span><span class="n">cgColor</span><span class="p">,</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">yellow</span><span class="p">.</span><span class="n">cgColor</span><span class="p">]</span>
</span><span class='line'>        <span class="n">gradientLayer</span><span class="o">?</span><span class="p">.</span><span class="n">locations</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>        <span class="n">gradientLayer</span><span class="o">?</span><span class="p">.</span><span class="n">startPoint</span> <span class="o">=</span> <span class="p">.</span><span class="n">zero</span>
</span><span class='line'>        <span class="n">gradientLayer</span><span class="o">?</span><span class="p">.</span><span class="n">endPoint</span> <span class="o">=</span> <span class="bp">CGPoint</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nl">y</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<!--
- CAMetalLayer

Used to set up and vend drawable textures for rendering layer content using Metal.

- CAEAGLLayer/CAOpenGLLayer

Used to set up the backing store and context for rendering layer content using OpenGL ES (iOS) or OpenGL (OS X).

- CAReplicatorLayer

Used when you want to make copies of one or more sublayers automatically. The replicator makes the copies for you and uses the properties you specify to alter the appearance or attributes of the copies.

- CAScrollLayer

Used to manage a large scrollable area composed of multiple sublayers.

- CAShapeLayer

Used to draw a cubic Bezier spline. Shape layers are advantageous for drawing path-based shapes because they always result in a crisp path, as opposed to a path you draw into a layer’s backing store, which would not look as good when scaled. However, the crisp results do involve rendering the shape on the main thread and caching the results.

- CATextLayer

Used to render a plain or attributed string of text.

- CATiledLayer

Used to manage a large image that can be divided into smaller tiles and rendered individually with support for zooming in and out of the content.

- CATransformLayer

Used to render a true 3D layer hierarchy, rather than the flattened layer hierarchy implemented by other layer classes.

- QCCompositionLayer

Used to render a Quartz Composer composition. (OS X only)
-->


<h4>4.2 设置Layer content</h4>

<p>设置Lyaer的content，三种方法</p>

<h5>4.2.1 给layer的<code>contents</code>属性，设置图片（适用于内容几乎不会或者很少改变</h5>

<ul>
<li><code>var contents: Any? { get set }</code> 使用<code>CGImage</code></li>
<li>赋值这个属性后，layer就会使用这个图片，而不会生成自己的<code>backing store</code></li>
<li>和UIView绑定的layer，最后不要单独设置这个属性</li>
</ul>


<h5>4.2.2 给layer设置<code>delegate</code>,让委托去绘制内容</h5>

<ul>
<li><code>UIView</code>底层的layer，自动和UIView设置了委托关系</li>
<li><p><code>weak var delegate: CALayerDelegate? { get set }</code></p></li>
<li><p><code>func display(_ layer: CALayer)</code></p>

<ul>
<li>当layer被标记为content需要reload是，例如在<code>setNeedsDisplay</code> 后会调用到该方法</li>
<li>在该方法中，一般通过设置layer的contens属性</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'>   <span class="k">func</span> <span class="nf">display</span><span class="p">(</span><span class="n">_</span> <span class="nl">layer</span><span class="p">:</span> <span class="bp">CALayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="k">if</span> <span class="k">let</span> <span class="n">image</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">loadImageFromBundle</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>           <span class="n">layer</span><span class="p">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">CGRect</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">width</span><span class="p">:</span> <span class="n">image</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="nl">height</span><span class="p">:</span> <span class="n">image</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
</span><span class='line'>           <span class="n">layer</span><span class="p">.</span><span class="n">contents</span> <span class="o">=</span> <span class="n">image</span>
</span><span class='line'>       <span class="p">}</span>
</span><span class='line'>   <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>func draw(_ layer: CALayer, in ctx: CGContext)</code>

<ul>
<li>当layer被标记为content需要reload是，例如在<code>setNeedsDisplay</code> 后会调用到该方法</li>
<li>如果委托实现了<code>display(_ :)</code>，该方法不会被调用</li>
</ul>
</li>
<li><code>func layerWillDraw(_ layer: CALayer)</code>

<ul>
<li>在绘制回调<code>draw(_ , in ctx:)</code> 之前被调用</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">draw</span><span class="p">(</span><span class="n">_</span> <span class="nl">layer</span><span class="p">:</span> <span class="bp">CALayer</span><span class="p">,</span> <span class="k">in</span> <span class="nl">ctx</span><span class="p">:</span> <span class="bp">CGContext</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">path</span> <span class="o">=</span> <span class="n">CGMutablePath</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">path</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="p">.</span><span class="n">zero</span><span class="p">)</span>
</span><span class='line'>    <span class="n">path</span><span class="p">.</span><span class="n">addRect</span><span class="p">(</span><span class="bp">CGRect</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">width</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nl">height</span><span class="p">:</span> <span class="mi">100</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ctx</span><span class="p">.</span><span class="n">setLineWidth</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ctx</span><span class="p">.</span><span class="n">setStrokeColor</span><span class="p">(</span><span class="bp">UIColor</span><span class="p">.</span><span class="n">red</span><span class="p">.</span><span class="n">cgColor</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ctx</span><span class="p">.</span><span class="n">addPath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ctx</span><span class="p">.</span><span class="n">strokePath</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">func</span> <span class="nf">layerWillDraw</span><span class="p">(</span><span class="n">_</span> <span class="nl">layer</span><span class="p">:</span> <span class="bp">CALayer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//called before draw(_ , in ctx:) </span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p><code>func layoutSublayers(of layer: CALayer)</code></p>

<ul>
<li>当layer的<code>bounds</code>改变时，需要重新对子layer进行布局</li>
</ul>
</li>
<li><p><code>func action(for layer: CALayer, forKey event: String) -&gt; CAAction?</code></p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">action</span><span class="p">(</span><span class="k">for</span> <span class="nl">layer</span><span class="p">:</span> <span class="bp">CALayer</span><span class="p">,</span> <span class="n">forKey</span> <span class="nl">event</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">CAAction</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">guard</span> <span class="n">event</span> <span class="o">==</span> <span class="s">&quot;moveRight&quot;</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">nil</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">animation</span> <span class="o">=</span> <span class="bp">CABasicAnimation</span><span class="p">()</span>
</span><span class='line'>    <span class="n">animation</span><span class="p">.</span><span class="n">valueFunction</span> <span class="o">=</span> <span class="bp">CAValueFunction</span><span class="p">.</span><span class="k">init</span><span class="p">(</span><span class="nl">name</span><span class="p">:</span> <span class="n">kCAValueFunctionTranslateX</span><span class="p">)</span>
</span><span class='line'>    <span class="n">animation</span><span class="p">.</span><span class="n">fromValue</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="n">animation</span><span class="p">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="mi">300</span>
</span><span class='line'>    <span class="n">animation</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">animation</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 外界调用</span>
</span><span class='line'><span class="n">fileprivate</span> <span class="k">func</span> <span class="n">moveLayerToRight</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">guard</span> <span class="k">let</span> <span class="n">action</span> <span class="o">=</span> <span class="n">startLayer</span><span class="p">.</span><span class="n">action</span><span class="p">(</span><span class="nl">forKey</span><span class="p">:</span> <span class="s">&quot;moveRight&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">action</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="nl">forKey</span><span class="p">:</span> <span class="s">&quot;transform&quot;</span><span class="p">,</span> <span class="nl">object</span><span class="p">:</span> <span class="n">startLayer</span><span class="p">,</span> <span class="nl">arguments</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h5>4.2.3 定义layer的子类，重写绘制的方法</h5>

<ul>
<li><code>func display()</code>

<ul>
<li>该方法的默认实现是，若当前layer有delegate，会去调用delegate 的 <code>func display(_ layer: CALayer)</code> 方法，若delegate，没有实现这个方法，这个方法，创建back store，然后调用layer的<code>func draw(in ctx: CGContext)</code></li>
<li>当layer被标记为content需要reload是，例如在<code>setNeedsDisplay</code> 后会调用到该方法</li>
<li>在该方法中，一般通过设置layer的contens属性</li>
</ul>
</li>
<li><code>func draw(in ctx: CGContext)</code>

<ul>
<li>绘制</li>
</ul>
</li>
</ul>


<h3>5. Contents Property</h3>

<ul>
<li><p>position-based gravity constants</p>

<p>  <img src="https://github.com/engili/engili.github.io/raw/master/images/layer_contentsgravity1_2x.png" width="547"></p></li>
<li><p>scalling-based gravity constatns</p>

<p>  <img src="https://github.com/engili/engili.github.io/raw/master/images/positioningmask_2x.png" width="472" height="255"></p></li>
</ul>


<h3>6. 定义Layer其他外观</h3>

<ul>
<li><code>background</code> 位于contents image 下</li>
<li><code>border</code> 位于contens image 上</li>
</ul>


<h3>7. layer Hierarchy</h3>

<ul>
<li>将layer添加到layer Hierarchy后，一定要设置layer的<code>bounds</code>和<code>position</code>,Core Animation 默认设置layer的长宽为0，layer的<code>position</code>为（0，0）</li>
<li>尽量使用整数设置Layer的长和宽</li>
</ul>

</div>


      <footer class="post-footer">
        <p class="meta text-muted">
          
  



<figure class="author-image">
    <span class="img" href="/about" style="background-image: url(/images/avatar.jpg)"><span class="hidden">Picture</span></span>
</figure>

<section class="author">
    <h4><span class="byline author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="fn" itemprop="name">limengtian</span></span></h4>

    <div class="author-meta">
        <span class="author-link icon-link"><i class="fa fa-link" aria-hidden="true"></i> <a href="http://engili.github.io">http://engili.github.io</a></span>
    </div>
</section>

<hr>

<section class="share">
    
    <h4>Share this post</h4>
    
    <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?url=http://engili.github.io/blog/2018/04/05/calayer-notes/;" 
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="fa fa-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://engili.github.io/blog/2018/04/05/calayer-notes/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="fa fa-google-plus" href="https://plus.google.com/share?url=http://engili.github.io/blog/2018/04/05/calayer-notes/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
    
</section>




<!--
<footer class="post-footer">


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Instant%20Movie%20Streamer%20v3%20Release&amp;url=http://iyask.me/instant-movie-streamer-v3-release/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://iyask.me/instant-movie-streamer-v3-release/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://iyask.me/instant-movie-streamer-v3-release/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


        </footer>


-->
          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2018-04-05T17:05:05+08:00"  data-updated="true" itemprop="datePublished dateCreated">Thu  5 Apr 2018,  5:05 PM</time>
          <br>

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/animations/'>animations</a>, <a class='category' href='/blog/categories/ios/'>ios</a>
  
</span>


        </p>
        
          <div class="pager">
            
            
              
                <a href="/blog/2018/04/01/keyboards-notes/" class="col-xs-12 col-md-4 btn btn-default" title="Previous Post: Keyboards 学习笔记"> 
                  <div class="text-muted">
                    <small>Previous Post</small>
                  </div>
                  <div class="pager-title">
                    <h4>Keyboards 学习笔记</h4>
                  </div>
                </a>
              
            
            
            
              
              <a href="/blog/2018/04/21/coreanimation-notes/" class="col-xs-12 col-md-4 btn btn-default pull-right" title="Next Post: Core Animation 学习笔记">
                <div class="text-muted">
                  <small>Next Post</small>
                </div>
                <div class="pager-title">
                  <h4>Core Animation 学习笔记</h4>
                </div>
              </a>
              
            
            
          </div>
        
      </footer>
    </article>
    
  </div>
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2018 - limengtian<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/bhrigu123/abacus">abacus theme</a></span>.
  </small>
</p>

</div>
</footer>
    








<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr.js"></script>


  </body>
</html>
